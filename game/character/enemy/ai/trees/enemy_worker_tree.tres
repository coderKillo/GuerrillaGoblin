[gd_resource type="BehaviorTree" load_steps=62 format=3 uid="uid://bqdatwroqrpnw"]

[ext_resource type="Script" path="res://game/character/enemy/ai/tasks/has_heard_sound.gd" id="1_3inll"]
[ext_resource type="Script" path="res://game/character/enemy/ai/tasks/find_target.gd" id="1_6dlm5"]
[ext_resource type="Script" path="res://game/character/enemy/ai/tasks/set_position_from_sound.gd" id="2_3s57x"]
[ext_resource type="Script" path="res://game/character/enemy/ai/tasks/notify_target.gd" id="2_jyxva"]
[ext_resource type="Script" path="res://game/character/enemy/ai/tasks/look_at.gd" id="3_nmomc"]
[ext_resource type="Script" path="res://game/character/enemy/ai/tasks/see_target.gd" id="3_pn1cb"]
[ext_resource type="Script" path="res://game/character/enemy/ai/tasks/set_target_position.gd" id="4_3uxe3"]
[ext_resource type="Script" path="res://game/character/enemy/ai/tasks/is_close_to_position.gd" id="5_qu0fb"]
[ext_resource type="Script" path="res://game/character/enemy/ai/tasks/next_path_point.gd" id="6_hn3d1"]
[ext_resource type="Script" path="res://game/character/enemy/ai/tasks/move_to_position.gd" id="7_8nxgk"]
[ext_resource type="Script" path="res://game/character/enemy/ai/tasks/stop_movement.gd" id="9_b5t0v"]

[sub_resource type="BlackboardPlan" id="BlackboardPlan_wyn8e"]
var/target_position/name = &"target_position"
var/target_position/type = 5
var/target_position/value = Vector2(0, 0)
var/target_position/hint = 0
var/target_position/hint_string = ""
var/path_position/name = &"path_position"
var/path_position/type = 5
var/path_position/value = Vector2(0, 0)
var/path_position/hint = 0
var/path_position/hint_string = ""
var/has_seen_target/name = &"has_seen_target"
var/has_seen_target/type = 1
var/has_seen_target/value = false
var/has_seen_target/hint = 0
var/has_seen_target/hint_string = ""
var/look_position/name = &"look_position"
var/look_position/type = 5
var/look_position/value = Vector2(0, 0)
var/look_position/hint = 0
var/look_position/hint_string = ""
var/guard_position/name = &"guard_position"
var/guard_position/type = 5
var/guard_position/value = Vector2(0, 0)
var/guard_position/hint = 0
var/guard_position/hint_string = ""
var/should_cower/name = &"should_cower"
var/should_cower/type = 1
var/should_cower/value = false
var/should_cower/hint = 0
var/should_cower/hint_string = ""

[sub_resource type="BBVariant" id="BBVariant_og60e"]
type = 1
saved_value = true
resource_name = "true"

[sub_resource type="BTCheckVar" id="BTCheckVar_texts"]
variable = &"should_cower"
value = SubResource("BBVariant_og60e")

[sub_resource type="BTAction" id="BTAction_2v34d"]
script = ExtResource("9_b5t0v")

[sub_resource type="BTSequence" id="BTSequence_r5xxi"]
custom_name = "cower"
children = [SubResource("BTCheckVar_texts"), SubResource("BTAction_2v34d")]

[sub_resource type="BBVariant" id="BBVariant_uyj4r"]
type = 5
saved_value = Vector2(0, 0)
resource_name = "(0, 0)"

[sub_resource type="BTCheckVar" id="BTCheckVar_68ajb"]
variable = &"guard_position"
check_type = 5
value = SubResource("BBVariant_uyj4r")

[sub_resource type="BTCondition" id="BTCondition_j80tq"]
script = ExtResource("5_qu0fb")
position = &"guard_position"
tolerance = 90.0

[sub_resource type="BTAction" id="BTAction_0dv2w"]
script = ExtResource("2_jyxva")
mode = 0
message = ""
message_var = &"target_position"
radius = 95.0

[sub_resource type="BBVariant" id="BBVariant_6oct8"]
type = 1
saved_value = true
resource_name = "true"

[sub_resource type="BTSetVar" id="BTSetVar_e52q7"]
variable = &"should_cower"
value = SubResource("BBVariant_6oct8")

[sub_resource type="BTSequence" id="BTSequence_qs2d7"]
children = [SubResource("BTAction_0dv2w"), SubResource("BTSetVar_e52q7")]

[sub_resource type="BTRunLimit" id="BTRunLimit_srxbq"]
children = [SubResource("BTSequence_qs2d7")]

[sub_resource type="BTSequence" id="BTSequence_4q7h8"]
custom_name = "if close notify guard"
children = [SubResource("BTCheckVar_68ajb"), SubResource("BTCondition_j80tq"), SubResource("BTRunLimit_srxbq")]

[sub_resource type="BBVariant" id="BBVariant_wl33w"]
type = 5
saved_value = Vector2(0, 0)
resource_name = "(0, 0)"

[sub_resource type="BTCheckVar" id="BTCheckVar_lrw53"]
variable = &"target_position"
check_type = 5
value = SubResource("BBVariant_wl33w")

[sub_resource type="BTAction" id="BTAction_plo35"]
script = ExtResource("1_6dlm5")
target_group = "guard"

[sub_resource type="BTAction" id="BTAction_lrp5r"]
script = ExtResource("4_3uxe3")
position = &"guard_position"

[sub_resource type="BTAction" id="BTAction_x46hd"]
script = ExtResource("7_8nxgk")
position = &"guard_position"
speed = 1.0

[sub_resource type="BTSequence" id="BTSequence_gw5wp"]
custom_name = "move to closest guard"
children = [SubResource("BTCheckVar_lrw53"), SubResource("BTAction_plo35"), SubResource("BTAction_lrp5r"), SubResource("BTAction_x46hd")]

[sub_resource type="BTSelector" id="BTSelector_3rd44"]
custom_name = "is target position set"
children = [SubResource("BTSequence_4q7h8"), SubResource("BTSequence_gw5wp")]

[sub_resource type="BTCondition" id="BTCondition_qe1w0"]
script = ExtResource("1_3inll")

[sub_resource type="BTAction" id="BTAction_20h1u"]
script = ExtResource("2_3s57x")
position = &"look_position"

[sub_resource type="BTAction" id="BTAction_w8kfw"]
script = ExtResource("3_nmomc")
position = &"look_position"

[sub_resource type="BTAction" id="BTAction_w5p58"]
script = ExtResource("9_b5t0v")

[sub_resource type="BBVariant" id="BBVariant_vppmm"]
type = 4
saved_value = "?"
resource_name = "?"

[sub_resource type="BTSetAgentProperty" id="BTSetAgentProperty_0xchn"]
property = &"status"
value = SubResource("BBVariant_vppmm")

[sub_resource type="BTSequence" id="BTSequence_xv45w"]
custom_name = "has hear sound"
children = [SubResource("BTCondition_qe1w0"), SubResource("BTAction_20h1u"), SubResource("BTAction_w8kfw"), SubResource("BTAction_w5p58"), SubResource("BTSetAgentProperty_0xchn")]

[sub_resource type="BTCondition" id="BTCondition_pp4yr"]
script = ExtResource("3_pn1cb")
target_group = "player"
view_angle = 60.0

[sub_resource type="BTAction" id="BTAction_7xtjj"]
script = ExtResource("4_3uxe3")
position = &"look_position"

[sub_resource type="BTAction" id="BTAction_vy7b6"]
script = ExtResource("3_nmomc")
position = &"look_position"

[sub_resource type="BTAction" id="BTAction_66xoq"]
script = ExtResource("9_b5t0v")

[sub_resource type="BBVariant" id="BBVariant_hnh21"]
type = 4
saved_value = "!"
resource_name = "!"

[sub_resource type="BTSetAgentProperty" id="BTSetAgentProperty_y5877"]
property = &"status"
value = SubResource("BBVariant_hnh21")

[sub_resource type="BTAction" id="BTAction_1m2tr"]
script = ExtResource("4_3uxe3")
position = &"target_position"

[sub_resource type="BTDelay" id="BTDelay_47rvc"]
seconds = 2.0
children = [SubResource("BTAction_1m2tr")]

[sub_resource type="BTSequence" id="BTSequence_2rtkn"]
custom_name = "has seen target"
children = [SubResource("BTCondition_pp4yr"), SubResource("BTAction_7xtjj"), SubResource("BTAction_vy7b6"), SubResource("BTAction_66xoq"), SubResource("BTSetAgentProperty_y5877"), SubResource("BTDelay_47rvc")]

[sub_resource type="BTSelector" id="BTSelector_c1ld5"]
custom_name = "has something happend"
children = [SubResource("BTSequence_xv45w"), SubResource("BTSequence_2rtkn")]

[sub_resource type="BBVariant" id="BBVariant_f4smv"]
type = 4
saved_value = ""

[sub_resource type="BTSetAgentProperty" id="BTSetAgentProperty_ryryx"]
property = &"status"
value = SubResource("BBVariant_f4smv")

[sub_resource type="BTCondition" id="BTCondition_l5h0o"]
script = ExtResource("5_qu0fb")
position = &"target_position"
tolerance = 50.0

[sub_resource type="BBVariant" id="BBVariant_ldidh"]
type = 5
saved_value = Vector2(0, 0)
resource_name = "<null>"

[sub_resource type="BTCheckVar" id="BTCheckVar_i8qx4"]
variable = &"path_position"
value = SubResource("BBVariant_ldidh")

[sub_resource type="BTSelector" id="BTSelector_ps7st"]
custom_name = "OR"
children = [SubResource("BTCondition_l5h0o"), SubResource("BTCheckVar_i8qx4")]

[sub_resource type="BTInvert" id="BTInvert_olnmt"]
custom_name = "not close or no path position"
children = [SubResource("BTSelector_ps7st")]

[sub_resource type="BTAction" id="BTAction_21bi2"]
script = ExtResource("6_hn3d1")
position = &"path_position"

[sub_resource type="BTSelector" id="BTSelector_mdr26"]
custom_name = "should set new path position"
children = [SubResource("BTInvert_olnmt"), SubResource("BTAction_21bi2")]

[sub_resource type="BTAction" id="BTAction_7e7io"]
script = ExtResource("7_8nxgk")
position = &"target_position"
speed = 0.5

[sub_resource type="BTSequence" id="BTSequence_8270m"]
custom_name = "else work"
children = [SubResource("BTSetAgentProperty_ryryx"), SubResource("BTSelector_mdr26"), SubResource("BTAction_7e7io")]

[sub_resource type="BTSelector" id="BTSelector_8dlph"]
custom_name = "Enemy Worker"
children = [SubResource("BTSequence_r5xxi"), SubResource("BTSelector_3rd44"), SubResource("BTSelector_c1ld5"), SubResource("BTSequence_8270m")]

[resource]
blackboard_plan = SubResource("BlackboardPlan_wyn8e")
root_task = SubResource("BTSelector_8dlph")
