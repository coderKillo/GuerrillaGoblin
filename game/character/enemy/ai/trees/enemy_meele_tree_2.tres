[gd_resource type="BehaviorTree" load_steps=45 format=3 uid="uid://dmkbd2ee3nbmd"]

[ext_resource type="Script" path="res://game/character/enemy/ai/tasks/is_position_valid.gd" id="1_m2lpx"]
[ext_resource type="Script" path="res://game/character/enemy/ai/tasks/look_at.gd" id="2_cickb"]
[ext_resource type="Script" path="res://game/character/enemy/ai/tasks/patrol.gd" id="3_c5quw"]
[ext_resource type="Script" path="res://game/character/enemy/ai/tasks/move_to_position.gd" id="3_v0bhw"]
[ext_resource type="Script" path="res://game/character/enemy/ai/tasks/attack.gd" id="4_4l1fq"]
[ext_resource type="Script" path="res://game/character/enemy/ai/tasks/reset_position.gd" id="5_vw6me"]
[ext_resource type="Script" path="res://game/character/enemy/ai/tasks/look_around.gd" id="6_rk5sp"]

[sub_resource type="BlackboardPlan" id="BlackboardPlan_anpm0"]
var/player_position/name = &"player_position"
var/player_position/type = 5
var/player_position/value = Vector2(0, 0)
var/player_position/hint = 0
var/player_position/hint_string = ""
var/last_seen_player_position/name = &"last_seen_player_position"
var/last_seen_player_position/type = 5
var/last_seen_player_position/value = Vector2(0, 0)
var/last_seen_player_position/hint = 0
var/last_seen_player_position/hint_string = ""
var/closest_guard/name = &"closest_guard"
var/closest_guard/type = 5
var/closest_guard/value = Vector2(0, 0)
var/closest_guard/hint = 0
var/closest_guard/hint_string = ""
var/closest_safe_spot/name = &"closest_safe_spot"
var/closest_safe_spot/type = 5
var/closest_safe_spot/value = Vector2(0, 0)
var/closest_safe_spot/hint = 0
var/closest_safe_spot/hint_string = ""
var/noise_position/name = &"noise_position"
var/noise_position/type = 5
var/noise_position/value = Vector2(0, 0)
var/noise_position/hint = 0
var/noise_position/hint_string = ""
var/is_alerted/name = &"is_alerted"
var/is_alerted/type = 1
var/is_alerted/value = false
var/is_alerted/hint = 0
var/is_alerted/hint_string = ""
var/check_out_position/name = &"check_out_position"
var/check_out_position/type = 5
var/check_out_position/value = Vector2(0, 0)
var/check_out_position/hint = 0
var/check_out_position/hint_string = ""

[sub_resource type="BTCondition" id="BTCondition_khpq0"]
script = ExtResource("1_m2lpx")
position = &"player_position"

[sub_resource type="BBVariant" id="BBVariant_0x5qp"]
type = 4
saved_value = "?"
resource_name = "?"

[sub_resource type="BTSetAgentProperty" id="BTSetAgentProperty_b0uq6"]
property = &"status"
value = SubResource("BBVariant_0x5qp")

[sub_resource type="BTAction" id="BTAction_e0r85"]
script = ExtResource("2_cickb")
position = &"player_position"

[sub_resource type="BTTimeLimit" id="BTTimeLimit_wo0gq"]
time_limit = 3.0
children = [SubResource("BTAction_e0r85")]

[sub_resource type="BTRunLimit" id="BTRunLimit_qsgli"]
count_policy = 1
children = [SubResource("BTTimeLimit_wo0gq")]

[sub_resource type="BBVariant" id="BBVariant_48kxn"]
type = 4
saved_value = "!"
resource_name = "!"

[sub_resource type="BTSetAgentProperty" id="BTSetAgentProperty_bvbm1"]
property = &"status"
value = SubResource("BBVariant_48kxn")

[sub_resource type="BBVariant" id="BBVariant_g2apr"]
type = 5
value_source = 1
variable = &"player_position"
resource_name = "$player_position"

[sub_resource type="BTSetVar" id="BTSetVar_uma4s"]
variable = &"last_seen_player_position"
value = SubResource("BBVariant_g2apr")

[sub_resource type="BTAction" id="BTAction_etlku"]
script = ExtResource("3_v0bhw")
position = &"player_position"
speed = 1.5
face_destination = true

[sub_resource type="BTAction" id="BTAction_h7hdj"]
script = ExtResource("4_4l1fq")

[sub_resource type="BTSequence" id="BTSequence_h2gvd"]
custom_name = "Chase"
children = [SubResource("BTSetAgentProperty_bvbm1"), SubResource("BTSetVar_uma4s"), SubResource("BTAction_etlku"), SubResource("BTAction_h7hdj")]

[sub_resource type="BTSelector" id="BTSelector_uobb6"]
children = [SubResource("BTRunLimit_qsgli"), SubResource("BTSequence_h2gvd")]

[sub_resource type="BTSequence" id="BTSequence_ecktm"]
custom_name = "see player"
children = [SubResource("BTCondition_khpq0"), SubResource("BTSetAgentProperty_b0uq6"), SubResource("BTSelector_uobb6")]

[sub_resource type="BTCondition" id="BTCondition_q62oj"]
script = ExtResource("1_m2lpx")
position = &"last_seen_player_position"

[sub_resource type="BBVariant" id="BBVariant_j6p1r"]
type = 4
saved_value = "?"
resource_name = "?"

[sub_resource type="BTSetAgentProperty" id="BTSetAgentProperty_y23mr"]
property = &"status"
value = SubResource("BBVariant_j6p1r")

[sub_resource type="BTAction" id="BTAction_ve0id"]
script = ExtResource("3_v0bhw")
position = &"last_seen_player_position"
speed = 1.2
face_destination = true

[sub_resource type="BTAction" id="BTAction_3rs61"]
script = ExtResource("5_vw6me")
position = &"last_seen_player_position"

[sub_resource type="BTAction" id="BTAction_sbsh7"]
script = ExtResource("6_rk5sp")
duration = 2.0
turns = 4

[sub_resource type="BTDynamicSequence" id="BTDynamicSequence_yii50"]
custom_name = "go to last seen player position"
children = [SubResource("BTCondition_q62oj"), SubResource("BTSetAgentProperty_y23mr"), SubResource("BTAction_ve0id"), SubResource("BTAction_3rs61"), SubResource("BTAction_sbsh7")]

[sub_resource type="BTCondition" id="BTCondition_i3y3n"]
script = ExtResource("1_m2lpx")
position = &"noise_position"

[sub_resource type="BBVariant" id="BBVariant_3j1we"]
type = 4
saved_value = "?"
resource_name = "?"

[sub_resource type="BTSetAgentProperty" id="BTSetAgentProperty_o110i"]
property = &"status"
value = SubResource("BBVariant_3j1we")

[sub_resource type="BTAction" id="BTAction_03fhk"]
script = ExtResource("2_cickb")
position = &"noise_position"

[sub_resource type="BTTimeLimit" id="BTTimeLimit_f1pc4"]
time_limit = 2.0
children = [SubResource("BTAction_03fhk")]

[sub_resource type="BTAction" id="BTAction_rmwjc"]
script = ExtResource("3_v0bhw")
position = &"noise_position"
speed = 0.8
face_destination = true

[sub_resource type="BTAction" id="BTAction_e13be"]
script = ExtResource("5_vw6me")
position = &"noise_position"

[sub_resource type="BTAction" id="BTAction_gul8k"]
script = ExtResource("6_rk5sp")
duration = 2.0
turns = 4

[sub_resource type="BTSequence" id="BTSequence_oo6pq"]
children = [SubResource("BTAction_rmwjc"), SubResource("BTAction_e13be"), SubResource("BTAction_gul8k")]

[sub_resource type="BTSelector" id="BTSelector_hrmvn"]
children = [SubResource("BTTimeLimit_f1pc4"), SubResource("BTSequence_oo6pq")]

[sub_resource type="BTDynamicSequence" id="BTDynamicSequence_ekaht"]
custom_name = "hear noise"
children = [SubResource("BTCondition_i3y3n"), SubResource("BTSetAgentProperty_o110i"), SubResource("BTSelector_hrmvn")]

[sub_resource type="BTAction" id="BTAction_xl54t"]
script = ExtResource("3_c5quw")
speed = 0.5

[sub_resource type="BTSequence" id="BTSequence_8i0y5"]
custom_name = "default"
children = [SubResource("BTAction_xl54t")]

[sub_resource type="BTDynamicSelector" id="BTDynamicSelector_bdxun"]
children = [SubResource("BTSequence_ecktm"), SubResource("BTDynamicSequence_yii50"), SubResource("BTDynamicSequence_ekaht"), SubResource("BTSequence_8i0y5")]

[resource]
blackboard_plan = SubResource("BlackboardPlan_anpm0")
root_task = SubResource("BTDynamicSelector_bdxun")
